var vis;!function(){"use strict";function e(e,t,s){e&&console.error(e),vis.firs=t,vis.world=s,y>0?vis.start():vis.draw(vis.params)}function t(){c.style("stroke-width",1.5/d3.event.scale+"px"),c.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function s(){d3.event.defaultPrevented&&d3.event.stopPropagation()}function a(){u.classed("active",!1),u=d3.select(null),d.transition().duration(750).call(j.translate([0,0]).scale(1).event)}function n(e){if(u.node()===this)return a();u.classed("active",!1),u=d3.select(this).classed("active",!0);var t=v.bounds(e),s=t[1][0]-t[0][0],n=t[1][1]-t[0][1],i=(t[0][0]+t[1][0])/2,l=(t[0][1]+t[1][1])/2,c=.9/Math.max(s/r,n/o),p=[r/2-c*i,o/2-c*l];d.transition().duration(750).call(j.translate(p).scale(c).event)}vis={};var r,o,l,d,c,u,p,v,f,h,m,A,g,y,B,w,b;vis.init=function(e){vis.params=e||{},l=d3.select(vis.params.chart||"#chart"),r=vis.params.width||960,o=vis.params.height||500,u=d3.select(null),d=l.selectAll("svg").data([{width:r,height:o}]).enter().append("svg"),d.attr({width:function(e){return e.width},height:function(e){return e.height}}),p=d.selectAll("rect.background").data([{}]).enter().append("rect").classed("background",!0),c=d.selectAll("g.all").data([{}]).enter().append("g").classed("all",!0),h=d.selectAll("style").data([{}]).enter().append("style").attr("type","text/css"),f=d.selectAll("defs").data([{}]).enter().append("defs"),m=d3.select(vis.params.slider||".slider"),m[0][0]?(g=m.property("max"),A=m.property("value"),m.on("change",function(){vis.stop(),A=this.value,vis.draw(vis.params)}),y=vis.params.running||0):y=-1,b=d3.select(vis.params.button||".button"),b[0][0]&&y>-1&&b.on("click",function(){y?vis.stop():vis.start()}),vis.loaddata(vis.params)},vis.loaddata=function(t){t||(t={});var s=(t.topo||"ectrl-firs.json")+(t.refresh?"#"+Math.random():""),a=(t.world||"world-50m.json")+(t.refresh?"#"+Math.random():"");queue().defer(d3.json,s).defer(d3.json,a).await(e)},vis.play=function(){i!==g||y||(A=-1,vis.stop()),i<g?(A+=1,y=1,d3.select(".stop").html("Pause").on("click",vis.stop(params)),m.property("value",B),vis.draw(params)):vis.stop()},vis.start=function(e){w=setInterval(function(){vis.play(e)},50)},vis.stop=function(e){clearInterval(w),y=0,d3.select(".stop").html("Play").on("click",vis.start(e))};var j=d3.behavior.zoom().scaleExtent([1,8e3]).on("zoom",t);vis.draw=function(e){var t,i,l=e||{},u=l.scale||530,f=(l.rotateLon||0,l.rotateLan||-53,d3.geo.azimuthalEqualArea().scale(u).translate([r/2,o/2]).rotate([0,-53]).clipAngle(179.999).precision(1)),h=topojson.feature(vis.firs,vis.firs.objects.firs).features,m=d3.select("#tooltip").classed("hidden",!0),A=m.select("#info"),g=d3.geo.graticule(),y=(topojson.feature(vis.world,vis.world.objects.land),topojson.feature(vis.world,vis.world.objects.countries).features),B=(topojson.mesh(vis.world,vis.world.objects.countries,function(e,t){return e.id!==t.id}),[{id:"BALTICFAB",name:"Baltic FAB"},{id:"BLUMEDFAB",name:"Blue Med FAB"},{id:"DANUBEFAB",name:"Danube FAB"},{id:"DKSEFAB",name:"Denmark-Sweden FAB"},{id:"FABCE",name:"FAB Central Europe (SES RP2)"},{id:"FABEC",name:"FAB Europe Central"},{id:"NEFAB",name:"North European FAB"},{id:"SWFAB",name:"South West FAB"},{id:"UKIRELANDFAB",name:"UK-Ireland FAB"}]);v=d3.geo.path().projection(f),d.on("click",s,!0),p.on("click",a),c.style("stroke-width","0.5px"),d.call(j.event),d.on("mousemove",function(){return m.style("top",event.pageY+16+"px").style("left",event.pageX+10+"px"),!0}),d.selectAll(".path.graticule").data([g]).enter().append("path").classed("graticule",!0).attr("d",v),t=c.selectAll(".country").data(y).enter().insert("path",".graticule").attr("class",function(e){return"country country"+e.id}).attr("d",v).text(function(e){return e.id}),i=c.selectAll(".fir").data(h).enter().insert("path",".graticule").attr("class",function(e){return"fir "+e.id}).attr("d",v).on("click",n).on("mouseover",function(e){d3.select(this).style("fill","red"),m.classed("hidden",!1),A.text(e.id+"; "+e.properties.name)}).on("mouseleave",function(){d3.select(this).style("fill","yellow"),m.classed("hidden",!0)}),c.selectAll(".fir-boundary").data([topojson.mesh(vis.firs,vis.firs.objects.firs,function(e,t){return e!==t})]).enter().insert("path",".graticule").attr("d",v).attr("class","fir-boundary"),c.selectAll("fir-boundary ECTRL").data([topojson.mesh(vis.firs,vis.firs.objects.firs,function(e,t){return e===t})]).enter().insert("path",".graticule").attr("d",v).attr("class","fir-boundary ECTRL"),B.forEach(function(e){var t=[],s=topojson.merge(vis.firs,vis.firs.objects.firs.geometries.filter(function(s){return s.properties.fab===e.id&&(t.push(s.id),!0)}));s.id=e.id,s.name=e.name,s.firs=t,c.append("path").datum(s).attr("class","fab "+e.id).attr("d",v).on("click",n).on("mouseover",function(e){d3.select(this).style("fill","red"),m.classed("hidden",!1),A.html("<p>"+e.name+"</p>")}).on("mouseleave",function(){d3.select(this).style("fill","blue"),m.classed("hidden",!0)})})}}();