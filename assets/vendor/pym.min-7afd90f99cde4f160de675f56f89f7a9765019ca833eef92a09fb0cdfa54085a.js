!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.pym=t.call(this)}(function(){var t="xPYMx",e={},s=function(t){var e=new RegExp("[\\?&]"+t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)"),s=e.exec(location.search);return null===s?"":decodeURIComponent(s[1].replace(/\+/g," "))},i=function(t,e){if("*"===e.xdomain||t.origin.match(new RegExp(e.xdomain+"$")))return!0},n=function(e,s,i){var n=["pym",e,s,i];return n.join(t)},a=function(e){var s=["pym",e,"(\\S+)","(.*)"];return new RegExp("^"+s.join(t)+"$")},r=function(){for(var t=e.autoInitInstances.length,s=t-1;s>=0;s--){var i=e.autoInitInstances[s];i.el.getElementsByTagName("iframe").length&&i.el.getElementsByTagName("iframe")[0].contentWindow||e.autoInitInstances.splice(s,1)}};return e.autoInitInstances=[],e.autoInit=function(){var t=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])"),s=t.length;r();for(var i=0;i<s;++i){var n=t[i];n.setAttribute("data-pym-auto-initialized",""),""===n.id&&(n.id="pym-"+i);var a=n.getAttribute("data-pym-src"),h={xdomain:"string",title:"string",name:"string",id:"string",sandbox:"string",allowfullscreen:"boolean"},o={};for(var l in h)if(null!==n.getAttribute("data-pym-"+l))switch(h[l]){case"boolean":o[l]=!("false"===n.getAttribute("data-pym-"+l));break;case"string":o[l]=n.getAttribute("data-pym-"+l);break;default:console.err("unrecognized attribute type")}var d=new e.Parent(n.id,a,o);e.autoInitInstances.push(d)}return e.autoInitInstances},e.Parent=function(t,e,s){this.id=t,this.url=e,this.el=document.getElementById(t),this.iframe=null,this.settings={xdomain:"*"},this.messageRegex=a(this.id),this.messageHandlers={},s=s||{},this._constructIframe=function(){var t=this.el.offsetWidth.toString();this.iframe=document.createElement("iframe");var e="",s=this.url.indexOf("#");for(s>-1&&(e=this.url.substring(s,this.url.length),this.url=this.url.substring(0,s)),this.url.indexOf("?")<0?this.url+="?":this.url+="&",this.iframe.src=this.url+"initialWidth="+t+"&childId="+this.id+"&parentTitle="+encodeURIComponent(document.title)+"&parentUrl="+encodeURIComponent(window.location.href)+e,this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("frameborder","0"),this.settings.title&&this.iframe.setAttribute("title",this.settings.title),void 0!==this.settings.allowfullscreen&&this.settings.allowfullscreen!==!1&&this.iframe.setAttribute("allowfullscreen",""),void 0!==this.settings.sandbox&&"string"==typeof this.settings.sandbox&&this.iframe.setAttribute("sandbox",this.settings.sandbox),this.settings.id&&(document.getElementById(this.settings.id)||this.iframe.setAttribute("id",this.settings.id)),this.settings.name&&this.iframe.setAttribute("name",this.settings.name);this.el.firstChild;)this.el.removeChild(this.el.firstChild);this.el.appendChild(this.iframe),window.addEventListener("resize",this._onResize)},this._onResize=function(){this.sendWidth()}.bind(this),this._fire=function(t,e){if(t in this.messageHandlers)for(var s=0;s<this.messageHandlers[t].length;s++)this.messageHandlers[t][s].call(this,e)},this.remove=function(){window.removeEventListener("message",this._processMessage),window.removeEventListener("resize",this._onResize),this.el.removeChild(this.iframe),r()},this._processMessage=function(t){if(i(t,this.settings)&&"string"==typeof t.data){var e=t.data.match(this.messageRegex);if(!e||3!==e.length)return!1;var s=e[1],n=e[2];this._fire(s,n)}}.bind(this),this._onHeightMessage=function(t){var e=parseInt(t);this.iframe.setAttribute("height",e+"px")},this._onNavigateToMessage=function(t){document.location.href=t},this._onScrollToChildPosMessage=function(t){var e=document.getElementById(this.id).getBoundingClientRect().top+window.pageYOffset,s=e+parseInt(t);window.scrollTo(0,s)},this.onMessage=function(t,e){t in this.messageHandlers||(this.messageHandlers[t]=[]),this.messageHandlers[t].push(e)},this.sendMessage=function(t,e){this.el.getElementsByTagName("iframe").length&&(this.el.getElementsByTagName("iframe")[0].contentWindow?this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(n(this.id,t,e),"*"):this.remove())},this.sendWidth=function(){var t=this.el.offsetWidth.toString();this.sendMessage("width",t)};for(var h in s)this.settings[h]=s[h];return this.onMessage("height",this._onHeightMessage),this.onMessage("navigateTo",this._onNavigateToMessage),this.onMessage("scrollToChildPos",this._onScrollToChildPosMessage),window.addEventListener("message",this._processMessage,!1),this._constructIframe(),this},e.Child=function(e){this.parentWidth=null,this.id=null,this.parentTitle=null,this.parentUrl=null,this.settings={renderCallback:null,xdomain:"*",polling:0},this.timerId=null,this.messageRegex=null,this.messageHandlers={},e=e||{},this.onMessage=function(t,e){t in this.messageHandlers||(this.messageHandlers[t]=[]),this.messageHandlers[t].push(e)},this._fire=function(t,e){if(t in this.messageHandlers)for(var s=0;s<this.messageHandlers[t].length;s++)this.messageHandlers[t][s].call(this,e)},this._processMessage=function(t){if(i(t,this.settings)&&"string"==typeof t.data){var e=t.data.match(this.messageRegex);if(e&&3===e.length){var s=e[1],n=e[2];this._fire(s,n)}}}.bind(this),this._onWidthMessage=function(t){var e=parseInt(t);e!==this.parentWidth&&(this.parentWidth=e,this.settings.renderCallback&&this.settings.renderCallback(e),this.sendHeight())},this.sendMessage=function(t,e){window.parent.postMessage(n(this.id,t,e),"*")},this.sendHeight=function(){var t=document.getElementsByTagName("body")[0].offsetHeight.toString();return this.sendMessage("height",t),t}.bind(this),this.scrollParentTo=function(t){this.sendMessage("navigateTo","#"+t)},this.navigateParentTo=function(t){this.sendMessage("navigateTo",t)},this.scrollParentToChildEl=function(t){var e=document.getElementById(t).getBoundingClientRect().top+window.pageYOffset;this.scrollParentToChildPos(e)},this.scrollParentToChildPos=function(t){this.sendMessage("scrollToChildPos",t.toString())},this._markWhetherEmbedded=function(t){var e,s=document.getElementsByTagName("html")[0],i=s.className;try{e=window.self!==window.top?"embedded":"not-embedded"}catch(t){e="embedded"}i.indexOf(e)<0&&(s.className=i+e,t&&t(e))},this.remove=function(){window.removeEventListener("message",this._processMessage),this.timerId&&clearInterval(this.timerId)},this.id=s("childId")||e.id,this.messageRegex=new RegExp("^pym"+t+this.id+t+"(\\S+)"+t+"(.*)$");var a=parseInt(s("initialWidth"));this.parentUrl=s("parentUrl"),this.parentTitle=s("parentTitle"),this.onMessage("width",this._onWidthMessage);for(var r in e)this.settings[r]=e[r];return window.addEventListener("message",this._processMessage,!1),this.settings.renderCallback&&this.settings.renderCallback(a),this.sendHeight(),this.settings.polling&&(this.timerId=window.setInterval(this.sendHeight,this.settings.polling)),this._markWhetherEmbedded(e.onMarkedEmbeddedStatus),this},e.autoInit(),e});